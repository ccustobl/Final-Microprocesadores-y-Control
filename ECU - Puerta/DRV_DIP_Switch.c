/***************************************************************************//**
 @file
 @brief
 @author   CCB
 ******************************************************************************/

/*******************************************************************************
 * INCLUDE HEADER FILES
 ******************************************************************************/

#include "DRV_DIP_Switch.h"

#include <msp430.h>
#include "gpio.h"
#include "board.h"

#include "APP_Data.h"
#include "APP_CAN_Format.h"

/*******************************************************************************
 * CONSTANT AND MACRO DEFINITIONS USING #DEFINE
 ******************************************************************************/

/*******************************************************************************
 * ENUMERATIONS AND STRUCTURES AND TYPEDEFS
 ******************************************************************************/

/*******************************************************************************
 * VARIABLES WITH GLOBAL SCOPE
 ******************************************************************************/

/*******************************************************************************
 * FUNCTION PROTOTYPES FOR PRIVATE FUNCTIONS WITH FILE LEVEL SCOPE
 ******************************************************************************/

/*******************************************************************************
 * STATIC VARIABLES AND CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/

/*******************************************************************************
 *******************************************************************************
 GLOBAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/

void DIP_Switch_Init(uint8_t pin1,uint8_t pin2)
{
    extern uint16_t CAN_ID;

#if CAN_ID_SELECT == DIP_SWITCH
    DS_Config_Pin(pin1,pin2);

    if(gpioRead(pin1)==0 && gpioRead(pin2)==0)
    {
        CAN_ID = ECU_PUERTA_DELANTERA_IZQUIERDA;
    }
    else if(gpioRead(pin1)==0 && gpioRead(pin2)==1)
    {
        CAN_ID = ECU_PUERTA_DELANTERA_DERECHA;
    }
    else if(gpioRead(pin1)==1 && gpioRead(pin2)==0)
    {
        CAN_ID = ECU_PUERTA_TRASERA_IZQUIERDA;
    }
    else if(gpioRead(pin1)==1 && gpioRead(pin2)==1)
    {
        CAN_ID = ECU_PUERTA_TRASERA_DERECHA;
    }

#endif
}


void DS_Config_Pin(uint8_t pin1,uint8_t pin2)
{
    uint8_t port1 = PIN2PORT(pin1);
    uint8_t num1 = PIN2NUM(pin1);
    uint8_t port2 = PIN2PORT(pin2);
    uint8_t num2 = PIN2NUM(pin2);

    switch(port1)
    {
    case 1:
        P1DIR &= ~(port1<<num1);
        break;
    case 2:
        P2DIR &= ~(port1<<num1);
        break;
    }

    switch(port2)
    {
    case 1:
        P1DIR &= ~(port2<<num2);
        break;
    case 2:
        P2DIR &= ~(port2<<num2);
        break;
    }
}

/*******************************************************************************
 *******************************************************************************
 LOCAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/

/******************************************************************************/
